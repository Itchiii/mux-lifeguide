fetch("accessTokenMapBox.txt").then(e=>e.text()).then(e=>{const o=e;var t=L.map("mapid").setView([48.37154,10.89851],13);L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:18,id:"mapbox.streets",accessToken:o}).addTo(t);var n=L.icon({iconUrl:"/public/assets/icons/icon-64.png",iconSize:[32,32],iconAnchor:[16,16]});L.marker([48.36592,10.88924],{icon:n}).addTo(t).bindPopup("<b>Hello world!</b><br>I am a popup.").openPopup(),L.Routing.control({router:L.Routing.mapbox(o),waypoints:[L.latLng(48.36592,10.88924),L.latLng(48.36801,10.89311)],routeWhileDragging:!1,autoRoute:!0,geocoder:L.Control.Geocoder.nominatim()}).addTo(t)});var slideout=new Slideout({panel:document.getElementById("panel"),menu:document.getElementById("menu"),padding:256,tolerance:70});class Database{constructor(e){this.name=e,this.remoteDB=new PouchDB(`http://localhost:5984/${this.name}`),this.localDB=new PouchDB(e),this.handlePreload()}handlePreload(){this.remoteDB.get("_local/preloaded").then(function(e,o){}.bind(this)).catch(function(e){if("not_found"!==e.name)throw e;return this.remoteDB.load(`${this.name}.txt`).then(function(){return this.remoteDB.put({_id:"_local/preloaded"})}.bind(this))}.bind(this)).then(function(){return this.remoteDB.allDocs({include_docs:!0})}.bind(this)).then(function(e){}.bind(this)).catch(console.log.bind(console))}get infoRemote(){this.remoteDB.info().then(function(e){return console.log(e)})}get infoLocal(){this.localDB.info().then(function(e){return console.log(e)})}_putItem(e,o){this.localDB.put({_id:`location-${e}`,title:o,director:o}).then(function(e){this._syncFromLocalToRemote()}.bind(this)).catch(function(e){console.warn("Error",e)})}_putImage(){fetch("baby-cat.jpg").then(e=>e.blob()).then(e=>{this.localDB.putAttachment("meowth","meowth.png",e,"image/jpg").then(function(){console.log(e);const o=URL.createObjectURL(e);document.querySelector("img").addEventListener("load",()=>URL.revokeObjectURL(o)),document.querySelector("img").src=o}.bind(e)).catch(function(){console.log("ah")})})}_syncFromLocalToRemote(){PouchDB.replicate(this.localDB,this.remoteDB,{live:!1,retry:!1,checkpoint:"source"}).on("change",function(e){}).on("paused",function(e){}).on("active",function(){}).on("denied",function(e){}).on("complete",function(e){}).on("error",function(e){console.console.warn("boo, we hit an error!",e)})}}const locationDB=new Database("locations");locationDB.infoRemote,locationDB._putItem("test5","test"),locationDB._putImage();const eventDB=new Database("events");eventDB.infoRemote,"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.getRegistrations().then(function(e){for(let o of e)o.unregister().then(function(e){e&&console.log("Unregistration succeeded")})}).then(function(){navigator.serviceWorker.register("/service-worker.js",{scope:"./"}).then(function(e){console.log("Registration succeeded.")}).catch(function(e){console.log("Registration failed with "+e)})}).catch(function(e){console.log("Service Worker unregistration failed: ",e)})});